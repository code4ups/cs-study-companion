---
import "../styles/global.css";
import BilingualToggle from "../components/BilingualToggle.tsx";
import DarkModeToggle from "../components/DarkModeToggle.tsx";
import ScrollToTop from "../components/ScrollToTop.tsx";

// Props
const {
    title = "CS Study Companion",
    lang = "en",
    base = "/cs-study-companion" // default base για GitHub Pages
} = Astro.props;

// Τίτλος σελίδας
const pageTitle =
    title && title !== "CS Study Companion"
        ? `${title} | CS Study Companion`
        : "CS Study Companion";
---

<!doctype html>
<html lang={lang}>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{pageTitle}</title>

    <!-- Preload favicon to prevent flicker during navigation -->
    <link rel="preload" href={`${base}/favicon.svg`} as="image" type="image/svg+xml" data-astro-rerun />

    <!-- Favicon - Multi-platform support -->
    <link rel="icon" type="image/svg+xml" href={`${base}/favicon.svg`} data-astro-rerun />
    <link rel="icon" type="image/png" sizes="32x32" href={`${base}/favicon-32x32.png`} data-astro-rerun />
    <link rel="icon" type="image/png" sizes="16x16" href={`${base}/favicon-16x16.png`} data-astro-rerun />
    <link rel="shortcut icon" href={`${base}/favicon.ico`} data-astro-rerun />

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" sizes="180x180" href={`${base}/apple-touch-icon.png`} data-astro-rerun />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="CS Study Companion" />

    <!-- Canonical URL for proper navigation -->
    <link rel="canonical" href={`https://code4ups.github.io${base}${Astro.url.pathname}`} />

    <!-- Android / Chrome -->
    <link rel="manifest" href={`${base}/manifest.json`} />
    <meta name="theme-color" content="#4F46E5" />
    <meta name="mobile-web-app-capable" content="yes" />

    <!-- Open Graph / Social Sharing -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content="Interactive Computer Science study companion with cheat sheets, programming glossaries, and vocabulary tools" />
    <meta property="og:image" content={`${base}/android-chrome-512x512.png`} />

    <!-- Additional Meta -->
    <meta name="description" content="Interactive Computer Science study companion with cheat sheets, programming glossaries, and vocabulary tools" />
    <!-- Prevent dark mode flash with saved preference priority -->
    <script is:inline>
        (function() {
            try {
                var saved = localStorage.getItem('theme');
                var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                var theme = saved || (prefersDark ? 'dark' : 'light');
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            } catch (_) {
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark');
                }
            }
        })();
    </script>
</head>
<body class="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 antialiased transition-colors duration-300">
<!-- Header -->
<header class="bg-indigo-600 dark:bg-indigo-800 text-white shadow transition-colors duration-300">
    <nav class="mx-auto flex max-w-6xl items-center justify-between px-6 py-4">
        <!-- Λογότυπο → πάει στην εισαγωγή της ΤΡΕΧΟΥΣΑΣ γλώσσας -->
        <a href={`${base}/${lang}/introduction`} class="text-xl sm:text-2xl font-bold">
            CS Study Companion
        </a>
        <!-- Δεξιά controls: BilingualToggle + DarkModeToggle -->
        <div class="flex items-center">
            <BilingualToggle lang={lang} client:load />
            <DarkModeToggle lang={lang} client:load />
        </div>
    </nav>
</header>

<!-- Main -->
<main class="mx-auto max-w-6xl px-6 py-8">
    <slot />
</main>

<!-- Footer -->
<footer class="mt-10 bg-gray-200 dark:bg-gray-800 text-gray-700 dark:text-gray-300 transition-colors duration-300">
    <div class="mx-auto max-w-6xl px-6 py-6 text-center text-sm">
        © {new Date().getFullYear()} CS Study Companion
    </div>
</footer>

<!-- ScrollToTop Component -->
<ScrollToTop client:load />
</body>
</html>